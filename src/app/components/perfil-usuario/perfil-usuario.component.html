<div class="container mx-auto px-4 py-8">
  <!-- Sección de perfil -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800">
        {{ editMode ? 'Editar Perfil' : 'Mi Perfil' }}
      </h1>
      <button 
        (click)="toggleEdit()" 
        class="px-4 py-2 rounded-md bg-primary text-white hover:bg-secondary transition cursor-pointer"
      >
        {{ editMode ? 'Cancelar' : 'Editar' }}
      </button>
    </div>

    <form [formGroup]="form" *ngIf="editMode; else viewMode">
      <div class="mb-4">
        <label class="block text-gray-700 mb-2">Nombre</label>
        <input 
          type="text" 
          formControlName="nombre" 
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          [class.border-red-500]="form.get('nombre')?.invalid && form.get('nombre')?.touched"
        >
        <div *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched" class="text-red-500 text-sm">
          <p *ngIf="form.get('nombre')?.errors?.['required']">El nombre es obligatorio.</p>
          <p *ngIf="form.get('nombre')?.errors?.['minlength']">El nombre debe tener al menos 3 caracteres.</p>
          
        </div> 
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-2">Descripción</label>
        <textarea 
          formControlName="descripcion" 
          rows="4"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          [class.border-red-500]="form.get('descripcion')?.invalid && form.get('descripcion')?.touched"
        ></textarea>
        <div *ngIf="form.get('descripcion')?.invalid && form.get('descripcion')?.touched" class="text-red-500 text-sm">
          <p *ngIf="form.get('descripcion')?.errors?.['required']">La descripción es obligatoria.</p>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-2">Habilidades (separadas por comas)</label>
        <textarea 
          formControlName="habilidades" 
          rows="2"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
        ></textarea>
      </div>

      <div class="mb-4">
        <label class="block text-gray-700 mb-2">Curriculum Vitae</label>
        <div *ngIf="usuario.cv; else noCV">
          <p class="text-green-600 mb-2">✔ Ya has subido tu CV, si quieres cambiarlo, selecciona uno nuevo</p>
        </div>
        <ng-template #noCV>
          <p class="text-red-600 mb-2">❌ No has subido tu CV todavía</p>
        </ng-template>
        <input 
          type="file" 
          (change)="onFileSelected($event)"
          accept=".pdf"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Selecciona un nuevo CV"
          [class.border-red-500]="cvError"
        >
        <p class="text-sm text-gray-500 mt-1">Sube tu CV en formato PDF</p>
        <small *ngIf="cvError" class="text-red-500 text-sm mt-1">
          {{ cvError }}
        </small>
      </div>

      <button 
        type="button" 
        (click)="guardarCambios()"
        class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition cursor-pointer"
      >
        Guardar Cambios
      </button>
    </form>

    <ng-template #viewMode>
      <div class="mb-4">
        <h2 class="text-2xl font-semibold text-gray-800">Hola, {{ usuario?.nombre }}</h2>
      </div>

      <div class="mb-4">
        <h3 class="text-lg font-medium text-gray-700 mb-2">Descripción Personal</h3>
        <p class="text-gray-600 whitespace-pre-line text-justify">{{ usuario?.descripcion || 'No hay descripción proporcionada' }}</p>
      </div>

      <div class="mb-4">
        <h3 class="text-lg font-medium text-gray-700 mb-2">Tus habilidades</h3>
        <ul class="list-disc list-inside text-gray-600">
          <li *ngFor="let habilidad of habilidadesArray">{{ habilidad?.trim() }}</li>
        </ul>
      </div>

      <div class="mb-4">
        <h3 class="text-lg font-medium text-gray-700 mb-2">Curriculum Vitae</h3>
        <p *ngIf="usuario?.cv" class="text-green-600">✔ Ya has subido tu CV</p>
        <p *ngIf="!usuario?.cv" class="text-red-600">❌ No has subido tu CV todavía</p>
      </div>
    </ng-template>
  </div>

  <!-- Sección de favoritos -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Mis Empleos Guardados</h2>
    
    <div *ngIf="favoritos.length > 0; else noFavoritos">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <app-card-empleo 
          *ngFor="let empleo of displayedFavoritos" 
          [empleo]="empleo"
          (favoritoCambiado)="eliminarDeFavoritos(empleo.id)"
        ></app-card-empleo>
      </div>

      <div class="mt-6 text-center flex justify-center items-center gap-4">
        <!-- Botón Mostrar más -->
        <button 
          *ngIf="hasMore"
          (click)="loadMore()"
          class="px-6 py-2 bg-primary text-white rounded-md hover:bg-secondary transition cursor-pointer"
        >
          Mostrar más
        </button>

        <!-- Botón Mostrar menos -->
        <button 
          *ngIf="displayedFavoritos.length > itemsPerPage"
          (click)="showLess()"
          class="px-6 py-2 bg-secondary text-white rounded-md hover:bg-background-alt hover:border hover:border-secondary hover:text-black transition cursor-pointer"
        >
          Mostrar menos
        </button>
      </div>
    </div>

    <ng-template #noFavoritos>
      <p class="text-gray-600">No tienes empleos guardados todavía.</p>
    </ng-template>
  </div>
</div>